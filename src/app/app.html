<div class="container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="title">
        <span class="animate-spin-slow">ğŸ”„</span>
        cURL to Postman Converter
      </h1>
      <div class="header-actions">
        <p class="subtitle">Convert browser cURL commands to Postman collections with automatic variables</p>
        <button (click)="toggleFeatures()" class="btn btn-secondary btn-sm">
          <span>â„¹ï¸</span>
          Features
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="two-column-layout">
    <!-- Left Column: Input -->
    <div class="flex flex-col gap-6">
      <!-- Input Section -->
      <section class="card">
        <div class="flex justify-between items-center mb-6 flex-wrap-mobile gap-4">
          <h2 class="text-2xl font-semibold text-gray-100">ğŸ“¥ Input</h2>
          <button (click)="clear()" class="btn btn-secondary">
            Clear
          </button>
        </div>

        <div class="flex flex-col gap-3">
          <textarea [(ngModel)]="curlInput" class="textarea" placeholder="Paste your cURL commands here (one or multiple)...

Example:
curl 'https://api.example.com/users' \\
  -H 'Authorization: Bearer eyJhbGc...' \\
  -H 'Content-Type: application/json'

curl 'https://api.example.com/posts' \\
  -H 'Authorization: Bearer eyJhbGc...'"></textarea>
          <p class="text-gray-400 text-sm">{{ curlCount() }}</p>
        </div>
      </section>

      <!-- Convert Button -->
      <div class="text-center">
        <button (click)="convert()" class="btn btn-primary text-lg px-8 py-3">
          <span class="text-xl">âš¡</span>
          Convert to Postman
        </button>
      </div>

      <!-- Info Section -->
      <section class="card">
        <h3 class="text-xl font-semibold text-gray-100 mb-4">â„¹ï¸ Features</h3>
        <ul class="feature-list">
          <li class="feature-item">
            âœ… Automatically detects repeated hosts and creates variables
          </li>
          <li class="feature-item">
            âœ… Identifies authentication tokens and generates environment variables
          </li>
          <li class="feature-item">
            âœ… Creates separate environments for localhost and remote domains
          </li>
          <li class="feature-item">
            âœ… Generates collections compatible with Postman Collection v2.1
          </li>
          <li class="feature-item">
            âœ… Supports multiple cURL commands in a single conversion
          </li>
        </ul>
      </section>
    </div>

    <!-- Right Column: Output -->
    <div class="output-column">
      @if (showOutput()) {
      <section class="card animate-fadeIn sticky-output">
        <div class="flex justify-between items-center mb-6 flex-wrap-mobile gap-4">
          <h2 class="text-2xl font-semibold text-gray-100">ğŸ“¤ Output</h2>
          <div class="flex gap-3 flex-wrap-mobile">
            <button (click)="copyToClipboard()" class="btn btn-secondary">
              <span>ğŸ“‹</span>
              Copy JSON
            </button>
            <button (click)="download()" class="btn btn-primary">
              <span>ğŸ’¾</span>
              Download
            </button>
          </div>
        </div>

        <div class="tabs">
          <button (click)="switchTab('summary')" [class.active]="currentTab() === 'summary'" class="tab">
            Summary
          </button>
          <button (click)="switchTab('collection')" [class.active]="currentTab() === 'collection'" class="tab">
            Postman Collection
          </button>
          <button (click)="switchTab('environment')" [class.active]="currentTab() === 'environment'" class="tab">
            Environments
          </button>
          <button (click)="switchTab('variables')" [class.active]="currentTab() === 'variables'" class="tab">
            Detected Variables
          </button>
        </div>

        <!-- Tab Content -->
        @if (currentTab() === 'summary') {
        <div class="animate-fadeIn">
          <div class="summary-container">
            <!-- Statistics -->
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value">{{ getSummaryData().totalRequests }}</div>
                <div class="stat-label">Requests</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">ğŸŒ</div>
                <div class="stat-value">{{ getSummaryData().totalHosts }}</div>
                <div class="stat-label">Hosts</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">ğŸ”‘</div>
                <div class="stat-value">{{ getSummaryData().totalTokens }}</div>
                <div class="stat-label">Tokens</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">ğŸŒ</div>
                <div class="stat-value">{{ getSummaryData().totalEnvironments }}</div>
                <div class="stat-label">Environments</div>
              </div>
            </div>

            <!-- Requests List with Editable Names -->
            @if (getSummaryData().requests.length > 0) {
            <div class="section-card">
              <h4 class="section-title">ğŸ“‹ Requests</h4>
              <div class="editable-list">
                @for (request of getSummaryData().requests; track $index) {
                <div class="editable-item">
                  <span class="method-badge" [class]="request.request.method.toLowerCase()">{{ request.request.method
                    }}</span>
                  <input type="text" class="editable-input" [value]="request.name"
                    (blur)="updateRequestName($index, $any($event.target).value)"
                    (keyup.enter)="$any($event.target).blur()" />
                  <span class="url-preview">{{ request.request.url.raw }}</span>
                </div>
                }
              </div>
            </div>
            }

            <!-- Environments List with Editable Names -->
            @if (getSummaryData().environments.length > 0) {
            <div class="section-card">
              <h4 class="section-title">ğŸŒ Environments</h4>
              <div class="editable-list">
                @for (env of getSummaryData().environments; track env.name) {
                <div class="editable-item">
                  <span class="env-badge" [class.local]="env.isLocal">{{ env.isLocal ? 'Local' : 'Remote' }}</span>
                  <input type="text" class="editable-input" [value]="editableEnvNames().get(env.name) || env.name"
                    (blur)="updateEnvironmentName(env.name, $any($event.target).value)"
                    (keyup.enter)="$any($event.target).blur()" />
                  <span class="url-preview">{{ env.protocol }}://{{ env.host }}</span>
                </div>
                }
              </div>
            </div>
            }
          </div>
        </div>
        }

        @if (currentTab() === 'collection') {
        <div class="animate-fadeIn">
          <pre class="code-block"><code>{{ collectionJson() }}</code></pre>
        </div>
        }

        @if (currentTab() === 'environment') {
        <div class="flex flex-col gap-6 animate-fadeIn">
          @for (env of currentEnvironments(); track env.name) {
          <div class="env-card">
            <h4>ğŸŒ {{ env.name }}</h4>
            <pre class="code-block"><code>{{ env | json }}</code></pre>
          </div>
          }
        </div>
        }

        @if (currentTab() === 'variables') {
        <div class="flex flex-col gap-6 animate-fadeIn">
          @if (getHostVariablesList().length > 0) {
          <div class="var-group">
            <h4 class="text-gray-100 mb-4 text-lg font-semibold">ğŸŒ Host Variables</h4>
            <ul class="var-list">
              @for (variable of getHostVariablesList(); track variable.name) {
              <li class="var-item">
                <span class="var-name">{{ variable.name }}</span>
                <span class="var-value">{{ variable.value }} (used {{ variable.count }} times)</span>
              </li>
              }
            </ul>
          </div>
          }

          @if (getTokenVariablesList().length > 0) {
          <div class="var-group">
            <h4 class="text-gray-100 mb-4 text-lg font-semibold">ğŸ”‘ Token Variables</h4>
            <ul class="var-list">
              @for (variable of getTokenVariablesList(); track variable.name) {
              <li class="var-item">
                <span class="var-name">{{ variable.name }}</span>
                <span class="var-value">{{ variable.value }} (used {{ variable.count }} times)</span>
              </li>
              }
            </ul>
          </div>
          }
        </div>
        }
      </section>
      } @else {
      <div class="card empty-state">
        <div class="text-center py-12">
          <div class="text-6xl mb-4">ğŸ“‹</div>
          <h3 class="text-xl font-semibold text-gray-100 mb-2">No output yet</h3>
          <p class="text-gray-400">Paste your cURL commands and click "Convert to Postman" to see the results</p>
        </div>
      </div>
      }
    </div>
  </main>

  <!-- Toast Notification -->
  @if (showToast()) {
  <div [class.success]="toastType() === 'success'" [class.error]="toastType() === 'error'" class="toast">
    {{ toastMessage() }}
  </div>
  }
</div>